"use client"

import { useState, useEffect } from "react"
import { useRouter } from "next/navigation"
import Link from "next/link"
import { motion } from "framer-motion"
import {
  LayoutDashboard,
  Image as ImageIcon,
  Users,
  Book,
  LogOut,
  Plus,
  Trash2,
  Edit,
  Save,
  X,
  Briefcase,
  Mail,
  RefreshCcw,
  Check,
  Shield,
  Key,
  LockIcon,
  Clock,
  Play
} from "lucide-react"

import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Textarea } from "@/components/ui/textarea"
import { Badge } from "@/components/ui/badge"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { useToast } from "@/components/ui/use-toast"
import GoogleDriveImage from "@/components/GoogleDriveImage"
import { 
  Dialog, 
  DialogContent, 
  DialogHeader, 
  DialogTitle,
  DialogDescription,
  DialogFooter
} from "@/components/ui/dialog"
import { Checkbox } from "@/components/ui/checkbox"

// Interface for gallery images
interface GalleryImage {
  _id?: string
  id?: number
  title: string
  description: string
  category: string
  tags: string[]
  url: string
  photographer: string
  featured?: boolean
}

interface Recruiter {
  _id?: string
  id?: string
  email: string
  firstName: string
  lastName: string
  company: string
  position: string
  phone?: string
  password?: string
  profilePicture?: string
  verified: boolean
  companyLogo?: string
  companyWebsite?: string
  companyDescription?: string
  industry?: string
  location?: string
  createdAt?: Date | string
  updatedAt?: Date | string
  jobsPosted?: any[]
}

interface Course {
  _id?: string
  id?: string
  title: string
  description: string
  thumbnail?: string
  instructor: string
  totalLessons?: number
  duration: number 
  level: 'beginner' | 'intermediate' | 'advanced'
  category: string
  tags: string[]
  price: number
  discountPrice?: number
  isPublished: boolean
  createdAt?: Date | string
  updatedAt?: Date | string
  lessonCount?: number
}

interface Lesson {
  _id?: string
  title: string
  description?: string
  course: string
  videoId: string
  videoSource?: string
  duration?: number
  order: number
  isPublished?: boolean
  materials?: {
    title: string
    fileUrl: string
  }[]
}

export default function AdminDashboard() {
  const [isAuthenticated, setIsAuthenticated] = useState(false)
  const [galleryImages, setGalleryImages] = useState<GalleryImage[]>([])
  const [recruiters, setRecruiters] = useState<Recruiter[]>([])
  const [isLoading, setIsLoading] = useState(false)
  const [isLoadingRecruiters, setIsLoadingRecruiters] = useState(false)
  const [jobStats, setJobStats] = useState({
    totalJobs: 0,
    activeJobs: 0,
    applications: 0
  })
  const [newImage, setNewImage] = useState<Omit<GalleryImage, "_id">>({
    title: "",
    description: "",
    category: "campus",
    tags: [],
    url: "",
    photographer: "",
    featured: false
  })
  const [newRecruiter, setNewRecruiter] = useState<Omit<Recruiter, "_id">>({
    email: "",
    firstName: "",
    lastName: "",
    company: "",
    position: "",
    phone: "",
    password: "",
    verified: false
  })
  const [newTag, setNewTag] = useState("")
  const [editingId, setEditingId] = useState<string | number | null>(null)
  const [editingRecruiterId, setEditingRecruiterId] = useState<string | null>(null)
  const [currentTab, setCurrentTab] = useState("gallery")
  const [newPasswordMap, setNewPasswordMap] = useState<Record<string, string>>({})
  const [showPasswordDialog, setShowPasswordDialog] = useState<string | null>(null)
  const [courses, setCourses] = useState<Course[]>([])
  const [isLoadingCourses, setIsLoadingCourses] = useState(false)
  const [newCourse, setNewCourse] = useState<Omit<Course, "_id">>({
    title: "",
    description: "",
    instructor: "",
    totalLessons: 1,
    duration: 1,
    level: "beginner",
    category: "Web Development",
    tags: [],
    price: 0,
    discountPrice: 0,
    isPublished: false
  })
  const [editingCourseId, setEditingCourseId] = useState<string | null>(null)
  const [courseTag, setCourseTag] = useState("")
  const [selectedCourse, setSelectedCourse] = useState<Course | null>(null)
  const [lessons, setLessons] = useState<Lesson[]>([])
  const [isLoadingLessons, setIsLoadingLessons] = useState(false)
  const [isAddingLesson, setIsAddingLesson] = useState(false)
  const [newLesson, setNewLesson] = useState<Lesson>({
    title: '',
    description: '',
    course: '',
    videoId: '',
    videoSource: 'drive',
    duration: 0,
    order: 0
  })
  const [editingLessonId, setEditingLessonId] = useState<string | null>(null)
  
  const router = useRouter()
  const { toast } = useToast()

  // Enhanced helper function to get admin token with better error handling and MongoDB fallback
  const getAdminAuthToken = async (redirectOnFailure = true): Promise<string | null> => {
    try {
      // Check both sessionStorage (primary) and localStorage (fallback)
      let adminAuthStr = sessionStorage.getItem("adminAuth");
      if (!adminAuthStr) {
        console.log("No adminAuth found in sessionStorage, checking localStorage");
        adminAuthStr = localStorage.getItem("adminAuth");
      }
      
      // If no token is found in storage, attempt to authenticate with MongoDB
      if (!adminAuthStr) {
        console.log("No adminAuth found in storage, attempting MongoDB authentication");
        const result = await mongoDbAuthentication();
        if (result) {
          return result; // Return the token from MongoDB auth
        }
        
        // Failed to authenticate with MongoDB
        if (redirectOnFailure) {
          toast({
            title: "Authentication Required",
            description: "Please log in to continue",
            variant: "destructive"
          });
          clearAuthData();
          router.push("/admin");
        }
        return null;
      }
      
      let adminAuth;
      try {
        adminAuth = JSON.parse(adminAuthStr);
      } catch (error) {
        console.error("Failed to parse adminAuth JSON", error);
        // Try MongoDB authentication as fallback
        const result = await mongoDbAuthentication();
        if (result) return result;
        
        if (redirectOnFailure) {
          toast({
            title: "Authentication Error", 
            description: "Invalid session data. Please log in again.",
            variant: "destructive"
          });
          clearAuthData();
          router.push("/admin");
        }
        return null;
      }
      
      // Check if authentication is valid
      if (!adminAuth || !adminAuth.isAuthenticated) {
        console.error("Admin not authenticated");
        // Try MongoDB authentication as fallback
        const result = await mongoDbAuthentication();
        if (result) return result;
        
        if (redirectOnFailure) {
          toast({
            title: "Authentication Error",
            description: "Your session is invalid. Please log in again.",
            variant: "destructive"
          });
          clearAuthData();
          router.push("/admin");
        }
        return null;
      }
      
      // Check if token exists
      if (!adminAuth.token) {
        console.error("No token found in admin auth data");
        // Try MongoDB authentication as fallback
        const result = await mongoDbAuthentication();
        if (result) return result;
        
        if (redirectOnFailure) {
          toast({
            title: "Authentication Error",
            description: "Invalid authentication token. Please log in again.",
            variant: "destructive"
          });
          clearAuthData();
          router.push("/admin");
        }
        return null;
      }
      
      // Check if token is expired
      if (adminAuth.expiresAt) {
        const expiresAt = new Date(adminAuth.expiresAt).getTime();
        if (Date.now() >= expiresAt) {
          console.error("Admin token expired");
          // Try MongoDB authentication as fallback
          const result = await mongoDbAuthentication();
          if (result) return result;
          
          if (redirectOnFailure) {
            toast({
              title: "Session Expired",
              description: "Your session has expired. Please log in again.",
              variant: "destructive"
            });
            clearAuthData();
            router.push("/admin");
          }
          return null;
        }
      }
      
      // Store in sessionStorage to ensure it's available across tabs
      if (!sessionStorage.getItem("adminAuth")) {
        sessionStorage.setItem("adminAuth", adminAuthStr);
      }
      
      return adminAuth.token;
    } catch (error) {
      console.error("Error retrieving admin auth token:", error);
      // Try MongoDB authentication as last resort
      const result = await mongoDbAuthentication();
      if (result) return result;
      
      if (redirectOnFailure) {
        toast({
          title: "Authentication Error",
          description: "An unexpected error occurred. Please log in again.",
          variant: "destructive"
        });
        clearAuthData();
        router.push("/admin");
      }
      return null;
    }
  };
  
  // Function to authenticate with MongoDB when no token is available
  const mongoDbAuthentication = async (): Promise<string | null> => {
    try {
      // Check if credentials are available in session storage
      const savedCredentials = sessionStorage.getItem("adminCredentials");
      if (!savedCredentials) {
        console.log("No saved credentials found");
        return null;
      }
      
      const { username, password } = JSON.parse(savedCredentials);
      if (!username || !password) {
        console.log("Incomplete credentials");
        return null;
      }
      
      console.log("Authenticating with MongoDB using saved credentials");
      
      // Make a request to your backend authentication endpoint
      const response = await fetch('/api/admin/authenticate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });
      
      if (!response.ok) {
        console.error("MongoDB authentication failed");
        return null;
      }
      
      const result = await response.json();
      
      if (result.success && result.token) {
        // Store the new token from MongoDB
        const authData = {
          username,
          isAuthenticated: true,
          role: "admin",
          token: result.token,
          timestamp: new Date().toISOString(),
          expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 hours
        };
        
        localStorage.setItem("adminAuth", JSON.stringify(authData));
        sessionStorage.setItem("adminAuth", JSON.stringify(authData));
        
        console.log("Successfully authenticated with MongoDB");
        return result.token;
      }
      
      return null;
    } catch (error) {
      console.error("Error in MongoDB authentication:", error);
      return null;
    }
  };
  
  // Helper to clear authentication data from all storage
  const clearAuthData = () => {
    localStorage.removeItem("adminAuth");
    sessionStorage.removeItem("adminAuth");
    // Keep credentials for possible re-authentication
  };
  
  // Update adminFetch to handle async token retrieval
  const adminFetch = async <T = any>(
    url: string, 
    options: RequestInit = {}, 
    errorMessage = "API request failed"
  ): Promise<T | null> => {
    try {
      const token = await getAdminAuthToken();
      if (!token) return null; // getAdminAuthToken already handles redirection
      
      const headers = {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
        ...(options.headers || {})
      };
      
      const response = await fetch(url, {
        ...options,
        headers
      });
      
      const result = await handleApiResponse(response, errorMessage);
      return result as T;
    } catch (error) {
      console.error(`Error in adminFetch (${url}):`, error);
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : errorMessage,
        variant: "destructive"
      });
      return null;
    }
  };

  // Function to store admin credentials for future use
  const storeAdminCredentials = (username: string, password: string) => {
    sessionStorage.setItem("adminCredentials", JSON.stringify({ username, password }));
  };

  // Manual authentication function to use when needed
  const authenticateAdmin = async (username: string, password: string): Promise<boolean> => {
    try {
      const response = await fetch('/api/admin/authenticate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ username, password })
      });
      
      if (!response.ok) return false;
      
      const result = await response.json();
      
      if (result.success && result.token) {
        // Store the token
        const authData = {
          username,
          isAuthenticated: true,
          role: "admin",
          token: result.token,
          timestamp: new Date().toISOString(),
          expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 hours
        };
        
        localStorage.setItem("adminAuth", JSON.stringify(authData));
        sessionStorage.setItem("adminAuth", JSON.stringify(authData));
        
        // Store credentials for future authentication
        storeAdminCredentials(username, password);
        
        return true;
      }
      
      return false;
    } catch (error) {
      console.error("Error in manual authentication:", error);
      return false;
    }
  };

  // Add a function to create API headers with authentication
  const createAuthHeaders = (extraHeaders = {}): HeadersInit => {
    const token = getAdminAuthToken();
    return {
      'Authorization': token ? `Bearer ${token}` : '',
      'Content-Type': 'application/json',
      ...extraHeaders
    };
  };
  
  // Function to handle API responses uniformly
  const handleApiResponse = async (response: Response, errorMessage = "API request failed") => {
    if (!response.ok) {
      // Handle authentication errors
      if (response.status === 401 || response.status === 403) {
        console.error("Authentication/Authorization failed. Redirecting to login.");
        toast({
          title: "Session Expired",
          description: "Please log in again to continue",
          variant: "destructive"
        });
        clearAuthData();
        router.push("/admin");
        return null;
      }
      
      // Handle other errors
      let message = `${errorMessage}: ${response.status} ${response.statusText}`;
      try {
        const contentType = response.headers.get("content-type");
        if (contentType && contentType.includes("application/json")) {
        const errorData = await response.json();
        console.error("Error details:", errorData);
        message = errorData.error || message;
        } else {
          console.error("Non-JSON error response:", await response.text());
        }
      } catch (e) {
        console.error("Error parsing error response:", e);
        // JSON parsing error, use default message
      }
      
      throw new Error(message);
    }
    
    // Parse successful response
    try {
      return await response.json();
    } catch (error) {
      console.error("Error parsing JSON response:", error);
      throw new Error("Invalid response format from server");
    }
  };

  // Check authentication on page load
  useEffect(() => {
    const verifyAuth = () => {
      // Use getAdminAuthToken with redirection on failure
      const token = getAdminAuthToken(true);
      if (!token) return;
      
      setIsAuthenticated(true);
      
      // Load data based on current tab
      if (currentTab === "gallery") {
        fetchGalleryImages();
      } else if (currentTab === "hr") {
        fetchRecruiters();
      } else if (currentTab === "dashboard") {
        fetchJobStats();
        if (recruiters.length === 0) {
          fetchRecruiters();
        }
      } else if (currentTab === "courses") {
        fetchCourses();
      }
    };
    
    verifyAuth();
  }, [router, currentTab, recruiters.length]); // Add proper dependencies

  // Handle logout with improved cleanup
  const handleLogout = () => {
    clearAuthData();
    setIsAuthenticated(false);
    router.push("/admin");
  };

  // Fetch gallery images from API
  const fetchGalleryImages = async () => {
    setIsLoading(true)
    try {
      const response = await fetch('/api/gallery')
      const result = await response.json()
      
      if (result.success) {
        setGalleryImages(result.data)
      } else {
        console.error('Failed to fetch gallery images:', result.error)
        toast({
          title: "Error",
          description: "Failed to load gallery images from server",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error fetching gallery images:', error)
      toast({
        title: "Error",
        description: "Network or server error occurred",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle adding a new tag to the image
  const handleAddTag = () => {
    if (!newTag.trim()) return
    
    if (editingId !== null) {
      // Adding tag to an image being edited
      setGalleryImages(prevImages => 
        prevImages.map(img => 
          img.id === editingId 
            ? { ...img, tags: [...img.tags, newTag.trim()] } 
            : img
        )
      )
    } else {
      // Adding tag to a new image
      setNewImage(prev => ({
        ...prev,
        tags: [...prev.tags, newTag.trim()]
      }))
    }
    
    setNewTag("")
  }

  // Handle removing a tag
  const handleRemoveTag = (tag: string) => {
    if (editingId !== null) {
      // Removing tag from an image being edited
      setGalleryImages(prevImages => 
        prevImages.map(img => 
          img.id === editingId 
            ? { ...img, tags: img.tags.filter(t => t !== tag) } 
            : img
        )
      )
    } else {
      // Removing tag from a new image
      setNewImage(prev => ({
        ...prev,
        tags: prev.tags.filter(t => t !== tag)
      }))
    }
  }

  // Handle adding a new image
  const handleAddImage = async () => {
    console.log("Upload button clicked");
    
    if (!newImage.title.trim()) {
      toast({
        title: "Error",
        description: "Please enter an image title",
        variant: "destructive"
      })
      return
    }
    
    if (!newImage.url.trim()) {
      toast({
        title: "Error",
        description: "Please enter a Google Drive file ID or URL",
        variant: "destructive"
      })
      return
    }
    
    // Check if it's a direct file ID (25-33 alphanumeric chars)
    const isFileId = /^[a-zA-Z0-9_-]{25,33}$/.test(newImage.url.trim());
    
    // If not a file ID, validate it's a Google Drive URL
    if (!isFileId) {
      const googleDriveUrlRegex = /https:\/\/(drive\.google\.com\/(file\/d\/|open\?id=)|docs\.google\.com\/(document|spreadsheets)\/d\/)/i;
      
      if (!googleDriveUrlRegex.test(newImage.url)) {
        toast({
          title: "Error",
          description: "Please enter either a valid Google Drive file ID or URL",
          variant: "destructive"
        })
        return
      }
    }
    
    // Get final URL for API submission
    let finalUrl = newImage.url.trim();
    
    // If it's just a file ID, store it as is - our component will handle converting it
    if (isFileId) {
      finalUrl = newImage.url.trim();
    } 
    // If it's a URL, extract the file ID if possible
    else {
      let fileId = "";
      
      if (newImage.url.includes('/file/d/')) {
        const match = newImage.url.match(/\/file\/d\/([^/]+)/);
        if (match) fileId = match[1];
      } else if (newImage.url.includes('id=')) {
        const match = newImage.url.match(/id=([^&]+)/);
        if (match) fileId = match[1];
      }
      
      // If we extracted a file ID, use just the ID for cleaner storage
      if (fileId) {
        finalUrl = fileId;
      }
    }
    
    console.log("Validation passed, sending data to API:", {...newImage, url: finalUrl});
    setIsLoading(true)
    try {
      // Send to API
      const response = await fetch('/api/gallery', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({...newImage, url: finalUrl}),
      })
      
      console.log("API response status:", response.status);
      
      if (!response.ok) {
        throw new Error(`Server returned ${response.status}: ${response.statusText}`);
      }
      
      const result = await response.json()
      console.log("API response data:", result);
      
      if (result.success) {
    // Reset form
    setNewImage({
      title: "",
      description: "",
      category: "campus",
      tags: [],
      url: "",
      photographer: "",
      featured: false
    })
        setNewTag("")
        
        // Refresh gallery images
        await fetchGalleryImages()
    
    toast({
      title: "Success",
      description: "Image added to gallery successfully",
    })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to add image to gallery",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error adding gallery image:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Network or server error occurred",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle edit button click
  const handleEditClick = (id: string | number) => {
    setEditingId(id)
  }

  // Handle save edits
  const handleSaveEdits = async () => {
    if (!editingId) return
    
    const imageToUpdate = galleryImages.find(img => 
      (img._id && img._id === editingId) || (img.id && img.id === editingId)
    )
    if (!imageToUpdate) return
    
    // Validate essential fields
    if (!imageToUpdate.title.trim()) {
      toast({
        title: "Error",
        description: "Image title cannot be empty",
        variant: "destructive"
      })
      return
    }
    
    if (!imageToUpdate.url.trim()) {
      toast({
        title: "Error",
        description: "Image URL cannot be empty",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    try {
      const idToUse = imageToUpdate._id || imageToUpdate.id;
      const response = await fetch(`/api/gallery/${idToUse}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(imageToUpdate),
      })
      
      if (!response.ok) {
        throw new Error(`Server returned ${response.status}: ${response.statusText}`)
      }
      
      const result = await response.json()
      
      if (result.success) {
    setEditingId(null)
        await fetchGalleryImages()
    
    toast({
      title: "Success",
      description: "Gallery image updated successfully",
    })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to update gallery image",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error updating gallery image:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Network or server error occurred",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle cancel edits
  const handleCancelEdits = () => {
    setEditingId(null)
    fetchGalleryImages() // Reload data to discard changes
  }

  // Handle delete image
  const handleDeleteImage = async (id: string | number) => {
    if (!id) {
      toast({
        title: "Error",
        description: "Invalid image ID",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    try {
      const response = await fetch(`/api/gallery/${id}`, {
        method: 'DELETE',
      })
      
      if (!response.ok) {
        throw new Error(`Server returned ${response.status}: ${response.statusText}`)
      }
      
      const result = await response.json()
      
      if (result.success) {
        // Remove from local state
        setGalleryImages(prevImages => prevImages.filter(img => 
          (img._id !== id) && (img.id !== id)
        ))
    
    toast({
      title: "Success",
      description: "Image deleted from gallery",
    })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to delete gallery image",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error deleting gallery image:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Network or server error occurred",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Update an edited image
  const handleUpdateEditedImage = (id: string | number, field: string, value: any) => {
    setGalleryImages(prevImages => 
      prevImages.map(img => 
        (img._id === id || img.id === id)
          ? { ...img, [field]: value } 
          : img
      )
    )
  }

  // Function to convert Google Drive URL to a viewable image URL
  const convertGoogleDriveUrl = (url: string): string => {
    // Handle empty URLs
    if (!url || url.trim() === '') return '';
    
    // Handle case when the input is just the file ID
    if (/^[a-zA-Z0-9_-]{25,33}$/.test(url.trim())) {
      return `https://drive.google.com/uc?export=view&id=${url.trim()}`;
    }
    
    // Extract file ID from various Google Drive URL formats
    let fileId = '';
    
    // Format: https://drive.google.com/file/d/{fileId}/view?usp=sharing
    if (url.includes('drive.google.com/file/d/')) {
      const match = url.match(/\/file\/d\/([^/]+)/);
      if (match && match[1]) {
        fileId = match[1];
      }
    } 
    // Format: https://drive.google.com/open?id={fileId}
    else if (url.includes('drive.google.com/open?id=')) {
      const match = url.match(/id=([^&]+)/);
      if (match && match[1]) {
        fileId = match[1];
      }
    }
    // Format: https://docs.google.com/document/d/{fileId}/edit
    else if (url.includes('docs.google.com') && url.includes('/d/')) {
      const match = url.match(/\/d\/([^/]+)/);
      if (match && match[1]) {
        fileId = match[1];
      }
    }
    // Already a file ID format or already converted URL
    else if (url.includes('drive.google.com/uc?')) {
      return url; // Already in correct format
    }
    
    // If fileId was successfully extracted, convert to direct image URL
    if (fileId) {
      return `https://drive.google.com/uc?export=view&id=${fileId}`;
    }
    
    // Return empty string if no valid format was found
    return '';
  }

  // Add a function to fetch recruiters
  const fetchRecruiters = async () => {
    setIsLoadingRecruiters(true)
    try {
      const token = getAdminAuthToken();
      if (!token) return; // getAdminAuthToken already handles redirection
      
      const response = await fetch('/api/admin/recruiters', {
        headers: createAuthHeaders()
      })
      
      // Handle non-ok responses
      try {
        const result = await handleApiResponse(response, "Failed to fetch recruiters");
        if (!result) {
          setRecruiters([]); 
          return;
        }
        
        if (result.success) {
          setRecruiters(result.data || [])
        } else {
          console.warn('API returned failure:', result.error)
          setRecruiters([])
        }
      } catch (error) {
        console.warn('Error processing recruiters response:', error)
        setRecruiters([])
      }
    } catch (error) {
      console.warn('Error fetching recruiters:', error)
      setRecruiters([])
    } finally {
      setIsLoadingRecruiters(false)
    }
  }

  // Add function to handle adding a new recruiter
  const handleAddRecruiter = async () => {
    if (!newRecruiter.email.trim() || !newRecruiter.firstName.trim() || 
        !newRecruiter.lastName.trim() || !newRecruiter.company.trim() || 
        !newRecruiter.position.trim() || !newRecruiter.password?.trim()) {
      toast({
        title: "Error",
        description: "Please fill in all required fields",
        variant: "destructive"
      })
      return
    }
    
    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    if (!emailRegex.test(newRecruiter.email)) {
      toast({
        title: "Error",
        description: "Please enter a valid email address",
        variant: "destructive"
      })
      return
    }

    // Validate password length
    if (newRecruiter.password.length < 6) {
      toast({
        title: "Error",
        description: "Password must be at least 6 characters long",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch('/api/admin/recruiters', {
        method: 'POST',
        body: JSON.stringify(newRecruiter)
      }, "Failed to add recruiter");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Add the new recruiter to our state
        setRecruiters(prev => [...prev, result.data])
        
        // Reset form
        setNewRecruiter({
          email: "",
          firstName: "",
          lastName: "",
          company: "",
          position: "",
          phone: "",
          password: "",
          verified: false
        })
        
        toast({
          title: "Success",
          description: "Recruiter added successfully",
        })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to add recruiter",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error adding recruiter:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to add recruiter",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Add function to handle editing a recruiter
  const handleEditRecruiterClick = (id: string) => {
    const recruiter = recruiters.find(r => r._id === id || r.id === id)
    if (recruiter) {
      setEditingRecruiterId(id)
    }
  }

  // Add function to save recruiter edits
  const handleSaveRecruiterEdits = async () => {
    if (!editingRecruiterId) return
    
    const recruiter = recruiters.find(r => r._id === editingRecruiterId || r.id === editingRecruiterId)
    if (!recruiter) return
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch(`/api/admin/recruiters/${editingRecruiterId}`, {
        method: 'PUT',
        body: JSON.stringify(recruiter)
      }, "Failed to update recruiter");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Update local state with the response data
        setRecruiters(prev => 
          prev.map(r => 
            (r._id === editingRecruiterId || r.id === editingRecruiterId)
              ? result.data
              : r
          )
        )
        
        setEditingRecruiterId(null)
        
        toast({
          title: "Success",
          description: "Recruiter updated successfully",
        })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to update recruiter",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error updating recruiter:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to update recruiter",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Add function to cancel recruiter edits
  const handleCancelRecruiterEdits = () => {
    setEditingRecruiterId(null)
  }

  // Add function to delete a recruiter
  const handleDeleteRecruiter = async (id: string) => {
    if (!confirm("Are you sure you want to delete this recruiter? This action cannot be undone.")) {
      return
    }
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch(`/api/admin/recruiters/${id}`, {
        method: 'DELETE'
      }, "Failed to delete recruiter");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Update local state
        setRecruiters(prev => prev.filter(r => r._id !== id && r.id !== id))
        
        toast({
          title: "Success",
          description: "Recruiter deleted successfully",
        })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to delete recruiter",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error deleting recruiter:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to delete recruiter",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Add function to toggle recruiter verification
  const handleToggleVerification = async (id: string) => {
    const recruiter = recruiters.find(r => r._id === id || r.id === id)
    if (!recruiter) return
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch(`/api/admin/recruiters/${id}/verify`, {
        method: 'POST',
        body: JSON.stringify({ verified: !recruiter.verified })
      }, "Failed to update verification status");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Update local state with the response data
        setRecruiters(prev => 
          prev.map(r => 
            (r._id === id || r.id === id)
              ? result.data
              : r
          )
        )
        
        toast({
          title: "Success",
          description: `Recruiter ${recruiter.verified ? 'unverified' : 'verified'} successfully`,
        })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to update verification status",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error toggling verification:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to update verification status",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Update an edited recruiter
  const handleUpdateEditedRecruiter = (id: string, field: string, value: any) => {
    setRecruiters(prevRecruiters => 
      prevRecruiters.map(r => 
        (r._id === id || r.id === id)
          ? { ...r, [field]: value } 
          : r
      )
    )
  }

  // Add a function to fetch job statistics
  const fetchJobStats = async () => {
    try {
      const token = getAdminAuthToken();
      if (!token) return; // getAdminAuthToken already handles redirection
      
      const response = await fetch('/api/admin/stats/jobs', {
        headers: createAuthHeaders()
      })
      
      try {
        const result = await handleApiResponse(response, "Failed to fetch job statistics");
        if (!result) return;
        
        if (result.success) {
          setJobStats(result.data)
        } else {
          console.error('Failed to fetch job statistics:', result.error)
        }
      } catch (error) {
        console.error('Error processing job stats response:', error)
      }
    } catch (error) {
      console.error('Error fetching job statistics:', error)
    }
  }

  // Handle updating recruiter password
  const handleUpdateRecruiterPassword = async (id: string) => {
    const newPassword = newPasswordMap[id]
    
    if (!newPassword || newPassword.trim().length < 6) {
      toast({
        title: "Error",
        description: "Password must be at least 6 characters long",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch(`/api/admin/recruiters/${id}/password`, {
        method: 'PUT',
        body: JSON.stringify({ password: newPassword })
      }, "Failed to update password");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Clear the password from the map
        setNewPasswordMap(prev => {
          const updated = { ...prev }
          delete updated[id]
          return updated
        })
        
        toast({
          title: "Success",
          description: "Recruiter password updated successfully",
        })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to update password",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error updating recruiter password:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to update password",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Fetch courses from API
  const fetchCourses = async () => {
    setIsLoadingCourses(true);
    try {
      console.log("Fetching courses from API: /api/courses/admin/all");
      
      const result = await adminFetch('/api/courses/admin/all', {}, "Failed to fetch courses");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoadingCourses(false);
        return;
      }
      
      console.log("Courses API response successful:", result.success);
      
      if (result.success) {
        setCourses(result.data || []);
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to fetch courses",
          variant: "destructive"
        });
      }
    } catch (error) {
      console.error('Error fetching courses:', error);
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to load courses",
        variant: "destructive"
      });
    } finally {
      setIsLoadingCourses(false);
    }
  };

  // Handle adding a course tag
  const handleAddCourseTag = () => {
    if (!courseTag.trim()) return
    
    if (editingCourseId !== null) {
      setCourses(prevCourses => 
        prevCourses.map(course => 
          (course._id === editingCourseId || course.id === editingCourseId)
            ? { ...course, tags: [...course.tags, courseTag.trim()] } 
            : course
        )
      )
    } else {
      setNewCourse(prev => ({
        ...prev,
        tags: [...prev.tags, courseTag.trim()]
      }))
    }
    
    setCourseTag("")
  }

  // Handle removing a course tag
  const handleRemoveCourseTag = (tag: string) => {
    if (editingCourseId !== null) {
      setCourses(prevCourses => 
        prevCourses.map(course => 
          (course._id === editingCourseId || course.id === editingCourseId)
            ? { ...course, tags: course.tags.filter(t => t !== tag) } 
            : course
        )
      )
    } else {
      setNewCourse(prev => ({
        ...prev,
        tags: prev.tags.filter(t => t !== tag)
      }))
    }
  }

  // Handle adding a new course
  const handleAddCourse = async () => {
    if (!newCourse.title.trim() || !newCourse.description.trim() || 
        !newCourse.instructor.trim() || !newCourse.category.trim() || 
        newCourse.price < 0) {
      toast({
        title: "Error",
        description: "Please fill in all required fields",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch('/api/courses/admin', {
        method: 'POST',
        body: JSON.stringify(newCourse)
      }, "Failed to add course");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        toast({
          title: "Success",
          description: "Course added successfully",
          variant: "default"
        })
        
        // Reset form
        setNewCourse({
          title: '',
          description: '',
          thumbnail: '',
          instructor: '',
          duration: 0,
          level: 'beginner',
          category: '',
          tags: [],
          price: 0,
          isPublished: false
        })
        
        // Refresh courses list
        fetchCourses()
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to add course",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error adding course:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to add course",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle edit course button click
  const handleEditCourseClick = (id: string) => {
    const course = courses.find(c => c._id === id || c.id === id)
    if (course) {
      setEditingCourseId(id)
    }
  }

  // Handle save course edits
  const handleSaveCourseEdits = async () => {
    if (!editingCourseId) return
    
    const courseToUpdate = courses.find(course => 
      (course._id && course._id === editingCourseId) || 
      (course.id && course.id === editingCourseId)
    )
    if (!courseToUpdate) return
    
    // Validate essential fields
    if (!courseToUpdate.title.trim() || !courseToUpdate.description.trim() || 
        !courseToUpdate.instructor.trim() || !courseToUpdate.category.trim() || 
        (courseToUpdate.totalLessons !== undefined && courseToUpdate.totalLessons < 1) || 
        courseToUpdate.duration < 1 || courseToUpdate.price < 0) {
      toast({
        title: "Error",
        description: "Please fill in all required fields",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    try {
      const idToUse = courseToUpdate._id || courseToUpdate.id;
      
      const result = await adminFetch(`/api/courses/${idToUse}`, {
        method: 'PUT',
        body: JSON.stringify(courseToUpdate),
      }, "Failed to update course");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        setEditingCourseId(null)
        toast({
          title: "Success",
          description: "Course updated successfully",
        })
        // Refresh courses list
        fetchCourses()
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to update course",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error updating course:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to update course",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle cancel course edits
  const handleCancelCourseEdits = () => {
    setEditingCourseId(null)
  }

  // Handle delete course
  const handleDeleteCourse = async (id: string) => {
    if (!window.confirm("Are you sure you want to delete this course? This action cannot be undone.")) {
      return
    }
    
    setIsLoading(true)
    try {
      const result = await adminFetch(`/api/courses/${id}`, {
        method: 'DELETE'
      }, "Failed to delete course");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Remove the course from the state
        setCourses(prev => prev.filter(course => 
          (course._id !== id && course.id !== id)
        ))
        
        toast({
          title: "Success",
          description: "Course deleted successfully",
        })
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to delete course",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error deleting course:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to delete course",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle updating edited course field values
  const handleUpdateEditedCourse = (id: string, field: string, value: any) => {
    setCourses(prevCourses => 
      prevCourses.map(course => 
        (course._id === id || course.id === id) 
          ? { ...course, [field]: value } 
          : course
      )
    )
  }

  // Handle toggling course published status
  const handleTogglePublished = async (id: string) => {
    const course = courses.find(c => c._id === id || c.id === id)
    if (!course) return
    
    setIsLoading(true)
    try {
      const idToUse = course._id || course.id;
      
      const result = await adminFetch(`/api/courses/${idToUse}`, {
        method: 'PUT',
        body: JSON.stringify({
          ...course,
          isPublished: !course.isPublished
        }),
      }, `Failed to ${course.isPublished ? 'unpublish' : 'publish'} course`);
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        // Update the course in state
        setCourses(prevCourses => 
          prevCourses.map(c => 
            (c._id === id || c.id === id) 
              ? { ...c, isPublished: !c.isPublished } 
              : c
          )
        )
        
        toast({
          title: "Success",
          description: `Course ${course.isPublished ? 'unpublished' : 'published'} successfully`,
        })
      } else {
        toast({
          title: "Error",
          description: result.error || `Failed to ${course.isPublished ? 'unpublish' : 'publish'} course`,
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error toggling course published status:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : `Failed to ${course.isPublished ? 'unpublish' : 'publish'} course`,
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Function to handle opening course lessons
  const handleManageLessons = async (courseId: string) => {
    setSelectedCourse(courses.find(course => (course._id || course.id) === courseId) || null)
    setIsAddingLesson(false)
    setEditingLessonId(null)
    fetchLessons(courseId)
  }

  // Fetch lessons for a course
  const fetchLessons = async (courseId: string) => {
    setIsLoadingLessons(true)
    try {
      const result = await adminFetch(`/api/courses/admin/${courseId}/lessons`, {}, "Failed to fetch lessons");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoadingLessons(false);
        return;
      }
      
      if (result.success) {
        setLessons(result.data)
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to fetch lessons",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error fetching lessons:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to load lessons",
        variant: "destructive"
      })
    } finally {
      setIsLoadingLessons(false)
    }
  }

  // Handle adding a new lesson
  const handleAddLesson = async () => {
    if (!selectedCourse) return
    
    if (!newLesson.title.trim() || !newLesson.videoId.trim()) {
      toast({
        title: "Error",
        description: "Please provide a title and video ID",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    
    try {
      const courseId = selectedCourse._id || selectedCourse.id
      
      const result = await adminFetch(`/api/courses/admin/${courseId}/lessons`, {
        method: 'POST',
        body: JSON.stringify(newLesson)
      }, "Failed to add lesson");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        toast({
          title: "Success",
          description: "Lesson added successfully",
          variant: "default"
        })
        
        // Reset form and refresh
        setNewLesson({
          title: '',
          description: '',
          course: courseId as string,
          videoId: '',
          videoSource: 'drive',
          duration: 0,
          order: 0
        })
        setIsAddingLesson(false)
        fetchLessons(courseId as string)
        fetchCourses() // Refresh course data to update lesson count
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to add lesson",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error adding lesson:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to add lesson",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle updating a lesson
  const handleUpdateLesson = async () => {
    if (!selectedCourse || !editingLessonId) return
    
    if (!newLesson.title.trim() || !newLesson.videoId.trim()) {
      toast({
        title: "Error",
        description: "Please provide a title and video ID",
        variant: "destructive"
      })
      return
    }
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch(`/api/lessons/admin/${editingLessonId}`, {
        method: 'PUT',
        body: JSON.stringify(newLesson)
      }, "Failed to update lesson");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        toast({
          title: "Success",
          description: "Lesson updated successfully",
          variant: "default"
        })
        
        // Reset form and refresh
        setNewLesson({
          title: '',
          description: '',
          course: selectedCourse._id || selectedCourse.id as string,
          videoId: '',
          videoSource: 'drive',
          duration: 0,
          order: 0
        })
        setIsAddingLesson(false)
        setEditingLessonId(null)
        fetchLessons(selectedCourse._id || selectedCourse.id as string)
        fetchCourses() // Refresh course data to update duration
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to update lesson",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error updating lesson:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to update lesson",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Handle editing a lesson
  const handleEditLessonClick = (lesson: Lesson) => {
    setEditingLessonId(lesson._id as string)
    setIsAddingLesson(true)
    setNewLesson({
      title: lesson.title,
      description: lesson.description || '',
      course: lesson.course,
      videoId: lesson.videoId,
      videoSource: lesson.videoSource || 'drive',
      duration: lesson.duration || 0,
      order: lesson.order
    })
  }

  // Handle deleting a lesson
  const handleDeleteLesson = async (lessonId: string) => {
    if (!selectedCourse) return
    
    if (!confirm("Are you sure you want to delete this lesson? This action cannot be undone.")) {
      return
    }
    
    setIsLoading(true)
    
    try {
      const result = await adminFetch(`/api/lessons/admin/${lessonId}`, {
        method: 'DELETE'
      }, "Failed to delete lesson");
      
      if (!result) {
        // Error already handled by adminFetch
        setIsLoading(false);
        return;
      }
      
      if (result.success) {
        toast({
          title: "Success",
          description: "Lesson deleted successfully",
          variant: "default"
        })
        
        // Refresh lessons and courses
        fetchLessons(selectedCourse._id || selectedCourse.id as string)
        fetchCourses()
      } else {
        toast({
          title: "Error",
          description: result.error || "Failed to delete lesson",
          variant: "destructive"
        })
      }
    } catch (error) {
      console.error('Error deleting lesson:', error)
      toast({
        title: "Error",
        description: error instanceof Error ? error.message : "Failed to delete lesson",
        variant: "destructive"
      })
    } finally {
      setIsLoading(false)
    }
  }

  // Function to handle back button in lesson management
  const handleBackToCourses = () => {
    setSelectedCourse(null)
    setLessons([])
    setIsAddingLesson(false)
    setEditingLessonId(null)
  }

  if (!isAuthenticated) {
    return null // Don't render anything if not authenticated
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-white to-blue-50">
      <div className="flex min-h-screen">
        {/* Sidebar */}
        <div className="w-64 bg-white border-r border-blue-100 shadow-lg">
          <div className="p-4 border-b border-blue-100">
            <div className="flex items-center">
              <div className="w-10 h-10 rounded-full bg-gradient-to-r from-red-600 to-purple-600 flex items-center justify-center mr-3">
                <span className="text-white font-bold">AJ</span>
              </div>
              <div>
                <h2 className="text-xl font-bold text-blue-900">Admin Panel</h2>
                <p className="text-sm text-blue-700">Academy Management</p>
              </div>
            </div>
          </div>
          <nav className="py-6 px-4">
            <ul className="space-y-2">
              <li>
                <button
                  onClick={() => setCurrentTab("dashboard")}
                  className={`flex items-center w-full px-4 py-2 rounded-lg text-left ${
                    currentTab === "dashboard" 
                      ? "bg-blue-100 text-blue-700" 
                      : "text-blue-600 hover:bg-blue-50"
                  }`}
                >
                  <LayoutDashboard className="w-5 h-5 mr-3" />
                  Dashboard
                </button>
              </li>
              <li>
                <button
                  onClick={() => setCurrentTab("gallery")}
                  className={`flex items-center w-full px-4 py-2 rounded-lg text-left ${
                    currentTab === "gallery" 
                      ? "bg-blue-100 text-blue-700" 
                      : "text-blue-600 hover:bg-blue-50"
                  }`}
                >
                  <ImageIcon className="w-5 h-5 mr-3" />
                  Gallery Manager
                </button>
              </li>
              <li>
                <button
                  onClick={() => setCurrentTab("hr")}
                  className={`flex items-center w-full px-4 py-2 rounded-lg text-left ${
                    currentTab === "hr" 
                      ? "bg-blue-100 text-blue-700" 
                      : "text-blue-600 hover:bg-blue-50"
                  }`}
                >
                  <Briefcase className="w-5 h-5 mr-3" />
                  HR Management
                </button>
              </li>
              <li>
                <button
                  onClick={() => setCurrentTab("users")}
                  className={`flex items-center w-full px-4 py-2 rounded-lg text-left ${
                    currentTab === "users" 
                      ? "bg-blue-100 text-blue-700" 
                      : "text-blue-600 hover:bg-blue-50"
                  }`}
                >
                  <Users className="w-5 h-5 mr-3" />
                  Users
                </button>
              </li>
              <li>
                <button
                  onClick={() => setCurrentTab("courses")}
                  className={`flex items-center w-full px-4 py-2 rounded-lg text-left ${
                    currentTab === "courses" 
                      ? "bg-blue-100 text-blue-700" 
                      : "text-blue-600 hover:bg-blue-50"
                  }`}
                >
                  <Book className="w-5 h-5 mr-3" />
                  Courses
                </button>
              </li>
            </ul>

            <div className="pt-6 mt-6 border-t border-blue-100">
              <button
                onClick={handleLogout}
                className="flex items-center w-full px-4 py-2 rounded-lg text-left text-red-600 hover:bg-red-50"
              >
                <LogOut className="w-5 h-5 mr-3" />
                Logout
              </button>
            </div>
          </nav>
        </div>
        
        {/* Main content */}
        <div className="flex-1 overflow-auto p-6">
          <Tabs value={currentTab} onValueChange={setCurrentTab} className="w-full">
            <TabsContent value="dashboard">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <Card className="bg-white border-blue-100 shadow-lg">
                  <CardHeader className="pb-2">
                    <CardTitle className="text-sm font-medium text-blue-700">Gallery Images</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-3xl font-bold text-blue-900">{galleryImages.length}</div>
                    <p className="text-blue-700 text-sm">Total images in gallery</p>
                  </CardContent>
                </Card>
                
                <Card className="bg-white border-blue-100 shadow-lg">
                  <CardHeader className="pb-2">
                    <CardTitle className="text-sm font-medium text-blue-700">Recruiters</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-3xl font-bold text-blue-900">{recruiters.length}</div>
                    <p className="text-blue-700 text-sm">Registered HR accounts</p>
                  </CardContent>
                </Card>
                
                <Card className="bg-white border-blue-100 shadow-lg">
                  <CardHeader className="pb-2">
                    <CardTitle className="text-sm font-medium text-blue-700">Active Jobs</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-3xl font-bold text-blue-900">{jobStats.activeJobs}</div>
                    <p className="text-blue-700 text-sm">Currently active job listings</p>
                  </CardContent>
                </Card>
                
                <Card className="bg-white border-blue-100 shadow-lg">
                  <CardHeader className="pb-2">
                    <CardTitle className="text-sm font-medium text-blue-700">Applications</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-3xl font-bold text-blue-900">{jobStats.applications}</div>
                    <p className="text-blue-700 text-sm">Total job applications</p>
                  </CardContent>
                </Card>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <Card className="bg-white border-blue-100 shadow-lg">
                  <CardHeader>
                    <CardTitle>Recent Recruiters</CardTitle>
                    <CardDescription>Recently registered HR accounts</CardDescription>
                  </CardHeader>
                  <CardContent>
                    {recruiters.length === 0 ? (
                      <div className="text-center py-4 text-blue-700">
                        No recruiters registered yet.
                      </div>
                    ) : (
                      <div className="space-y-3">
                        {recruiters.slice(0, 3).map((recruiter) => (
                          <div key={recruiter._id || recruiter.id} className="flex items-center justify-between border-b border-blue-50 pb-3">
                            <div>
                              <div className="font-medium text-blue-900">
                                {recruiter.firstName} {recruiter.lastName}
                              </div>
                              <div className="text-xs text-blue-700">
                                {recruiter.company} - {recruiter.position}
                              </div>
                            </div>
                            <div>
                              {recruiter.verified ? (
                                <Badge className="bg-green-100 text-green-800 hover:bg-green-200">
                                  <Check className="h-3 w-3 mr-1" />
                                  Verified
                                </Badge>
                              ) : (
                                <Badge className="bg-amber-100 text-amber-800 hover:bg-amber-200">
                                  <Shield className="h-3 w-3 mr-1" />
                                  Unverified
                                </Badge>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </CardContent>
                  <CardFooter>
                    <Button variant="outline" size="sm" onClick={() => setCurrentTab("hr")} className="w-full">
                      <Briefcase className="h-4 w-4 mr-2" />
                      Manage Recruiters
                    </Button>
                  </CardFooter>
                </Card>
                
                <Card className="bg-white border-blue-100 shadow-lg">
                  <CardHeader>
                    <CardTitle>Job Portal Stats</CardTitle>
                    <CardDescription>Overview of the job portal</CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-4">
                      <div className="flex items-center justify-between">
                        <div className="text-blue-900">Total Jobs</div>
                        <div className="font-medium">{jobStats.totalJobs}</div>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="text-blue-900">Active Jobs</div>
                        <div className="font-medium">{jobStats.activeJobs}</div>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="text-blue-900">Inactive Jobs</div>
                        <div className="font-medium">{jobStats.totalJobs - jobStats.activeJobs}</div>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="text-blue-900">Total Applications</div>
                        <div className="font-medium">{jobStats.applications}</div>
                      </div>
                      <div className="flex items-center justify-between">
                        <div className="text-blue-900">Avg. Applications per Job</div>
                        <div className="font-medium">
                          {jobStats.totalJobs > 0 
                            ? (jobStats.applications / jobStats.totalJobs).toFixed(1) 
                            : "0.0"}
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </TabsContent>
            
            <TabsContent value="gallery" className="space-y-6">
              <div className="mb-6">
                <h1 className="text-2xl font-bold text-blue-900">Gallery Manager</h1>
                <p className="text-blue-700">Add and manage gallery images</p>
              </div>
              
              {/* Add new image form */}
              <Card className="bg-white border-blue-100 shadow-lg">
                <CardHeader>
                  <CardTitle>Add New Image</CardTitle>
                  <CardDescription>Add a new image from Google Drive to the gallery</CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="title">Image Title</Label>
                      <Input 
                        id="title" 
                        value={newImage.title}
                        onChange={(e) => setNewImage({...newImage, title: e.target.value})}
                        placeholder="Enter image title"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="photographer">Photographer</Label>
                      <Input 
                        id="photographer" 
                        value={newImage.photographer}
                        onChange={(e) => setNewImage({...newImage, photographer: e.target.value})}
                        placeholder="Enter photographer name"
                      />
                    </div>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="description">Description</Label>
                    <Textarea 
                      id="description" 
                      value={newImage.description}
                      onChange={(e) => setNewImage({...newImage, description: e.target.value})}
                      placeholder="Enter image description"
                      rows={3}
                    />
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="category">Category</Label>
                      <Select 
                        value={newImage.category}
                        onValueChange={(value) => setNewImage({...newImage, category: value})}
                      >
                        <SelectTrigger>
                          <SelectValue placeholder="Select category" />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="campus">Campus</SelectItem>
                          <SelectItem value="students">Students</SelectItem>
                          <SelectItem value="events">Events</SelectItem>
                          <SelectItem value="classroom">Classroom</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="featured">Featured</Label>
                      <Select 
                        value={newImage.featured ? "yes" : "no"}
                        onValueChange={(value) => setNewImage({...newImage, featured: value === "yes"})}
                      >
                        <SelectTrigger>
                          <SelectValue placeholder="Is this a featured image?" />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="yes">Yes</SelectItem>
                          <SelectItem value="no">No</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="url">Google Drive File ID or URL</Label>
                    <div className="text-xs text-blue-600 mb-1">
                      Paste either the file ID (example: 1KTSWBRxFxQ9bVxr4GcQOj2YZD32GoWyi) or the full Google Drive sharing link
                    </div>
                    <Input 
                      id="url" 
                      value={newImage.url}
                      onChange={(e) => setNewImage({...newImage, url: e.target.value})}
                      placeholder="1KTSWBRxFxQ9bVxr4GcQOj2YZD32GoWyi or https://drive.google.com/file/d/..."
                    />
                    {newImage.url && (
                      <div className="mt-2">
                        <div className="text-xs text-blue-700 mb-1">Image Preview:</div>
                        <div className="aspect-video bg-blue-50 rounded-md overflow-hidden">
                          <GoogleDriveImage 
                            url={newImage.url}
                              alt="Preview" 
                            aspectRatio="video"
                          />
                                </div>
                        <div className="text-xs text-gray-500 mt-1">
                          Make sure the file is shared with "Anyone with the link" permission in Google Drive
                        </div>
                      </div>
                    )}
                  </div>
                  
                  <div className="space-y-2">
                    <Label>Tags</Label>
                    <div className="flex flex-wrap gap-2 mb-2">
                      {newImage.tags.map((tag) => (
                        <Badge key={tag} className="bg-blue-100 text-blue-700 hover:bg-blue-200">
                          {tag}
                          <button 
                            className="ml-1 text-blue-700 hover:text-blue-900"
                            onClick={() => handleRemoveTag(tag)}
                          >
                            <X className="h-3 w-3" />
                          </button>
                        </Badge>
                      ))}
                    </div>
                    <div className="flex">
                      <Input 
                        value={newTag}
                        onChange={(e) => setNewTag(e.target.value)}
                        placeholder="Add a tag"
                        className="rounded-r-none"
                        onKeyDown={(e) => {
                          if (e.key === 'Enter') {
                            e.preventDefault();
                            handleAddTag();
                          }
                        }}
                      />
                      <Button 
                        type="button" 
                        onClick={handleAddTag}
                        className="rounded-l-none"
                      >
                        Add
                      </Button>
                    </div>
                  </div>
                </CardContent>
                <CardFooter className="flex gap-3">
                  <Button 
                    variant="outline" 
                    onClick={() => {
                      setNewImage({
                        title: "",
                        description: "",
                        category: "campus",
                        tags: [],
                        url: "",
                        photographer: "",
                        featured: false
                      });
                      setNewTag("");
                    }}
                  >
                    <X className="h-4 w-4 mr-2" />
                    Clear
                  </Button>
                  <Button 
                    onClick={handleAddImage}
                    disabled={isLoading}
                  >
                    {isLoading ? (
                      <>
                        <div className="animate-spin h-4 w-4 mr-2 border-2 border-t-transparent border-white rounded-full" />
                        Uploading...
                      </>
                    ) : (
                      <>
                    <Plus className="h-4 w-4 mr-2" />
                        Upload
                      </>
                    )}
                  </Button>
                </CardFooter>
              </Card>
              
              {/* Gallery Image List */}
              <Card className="bg-white border-blue-100 shadow-lg">
                <CardHeader>
                  <CardTitle>Gallery Images</CardTitle>
                  <CardDescription>Manage existing gallery images</CardDescription>
                </CardHeader>
                <CardContent>
                  {isLoading ? (
                    <div className="flex justify-center py-8">
                      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    </div>
                  ) : (
                  <div className="space-y-4">
                    {galleryImages.length === 0 ? (
                      <div className="text-center py-8 text-blue-700">
                        No images added to the gallery yet. Add your first image above.
                      </div>
                    ) : (
                      galleryImages.map((image) => (
                        <div 
                            key={image._id || image.id} 
                          className="border border-blue-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow"
                        >
                          <div className="flex flex-col md:flex-row gap-4">
                            {/* Image preview */}
                            <div className="w-full md:w-1/4">
                              <div className="aspect-video bg-blue-50 rounded flex items-center justify-center overflow-hidden">
                                  <GoogleDriveImage 
                                    url={image.url}
                                    alt={image.title}
                                    aspectRatio="video"
                                  />
                              </div>
                              
                              <div className="mt-2 text-sm text-blue-600 truncate">
                                {image.url}
                              </div>
                            </div>
                            
                            {/* Image details */}
                            <div className="flex-1">
                                {editingId === (image._id || image.id) ? (
                                <div className="space-y-3">
                                  <Input 
                                    value={image.title}
                                      onChange={(e) => handleUpdateEditedImage(image._id || image.id || "", "title", e.target.value)}
                                    className="font-bold text-blue-900"
                                  />
                                  
                                  <Textarea 
                                    value={image.description}
                                      onChange={(e) => handleUpdateEditedImage(image._id || image.id || "", "description", e.target.value)}
                                    rows={2}
                                  />
                                  
                                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <Select 
                                      value={image.category}
                                        onValueChange={(value) => handleUpdateEditedImage(image._id || image.id || "", "category", value)}
                                    >
                                      <SelectTrigger>
                                        <SelectValue placeholder="Select category" />
                                      </SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="campus">Campus</SelectItem>
                                        <SelectItem value="students">Students</SelectItem>
                                        <SelectItem value="events">Events</SelectItem>
                                        <SelectItem value="classroom">Classroom</SelectItem>
                                      </SelectContent>
                                    </Select>
                                    
                                    <Input 
                                      value={image.photographer}
                                        onChange={(e) => handleUpdateEditedImage(image._id || image.id || "", "photographer", e.target.value)}
                                      placeholder="Photographer"
                                    />
                                  </div>
                                  
                                  <div>
                                    <Input 
                                      value={image.url}
                                        onChange={(e) => handleUpdateEditedImage(image._id || image.id || "", "url", e.target.value)}
                                    />
                                  </div>
                                  
                                  <div>
                                    <div className="flex flex-wrap gap-2 mb-2">
                                      {image.tags.map((tag) => (
                                        <Badge key={tag} className="bg-blue-100 text-blue-700 hover:bg-blue-200">
                                          {tag}
                                          <button 
                                            className="ml-1 text-blue-700 hover:text-blue-900"
                                            onClick={() => handleRemoveTag(tag)}
                                          >
                                            <X className="h-3 w-3" />
                                          </button>
                                        </Badge>
                                      ))}
                                    </div>
                                    <div className="flex">
                                      <Input 
                                        value={newTag}
                                        onChange={(e) => setNewTag(e.target.value)}
                                        placeholder="Add a tag"
                                        className="rounded-r-none"
                                        onKeyDown={(e) => {
                                          if (e.key === 'Enter') {
                                            e.preventDefault();
                                            handleAddTag();
                                          }
                                        }}
                                      />
                                      <Button 
                                        type="button" 
                                        onClick={handleAddTag}
                                        className="rounded-l-none"
                                      >
                                        Add
                                      </Button>
                                    </div>
                                  </div>
                                  
                                  <Select 
                                    value={image.featured ? "yes" : "no"}
                                      onValueChange={(value) => handleUpdateEditedImage(image._id || image.id || "", "featured", value === "yes")}
                                  >
                                    <SelectTrigger>
                                      <SelectValue placeholder="Is this a featured image?" />
                                    </SelectTrigger>
                                    <SelectContent>
                                      <SelectItem value="yes">Featured</SelectItem>
                                      <SelectItem value="no">Not Featured</SelectItem>
                                    </SelectContent>
                                  </Select>
                                </div>
                              ) : (
                                <>
                                  <h3 className="font-bold text-blue-900 text-lg">{image.title}</h3>
                                  <p className="text-blue-700 mt-1">{image.description}</p>
                                  
                                  <div className="flex flex-wrap gap-2 mt-3">
                                    <Badge className="bg-blue-100 text-blue-700">
                                      {image.category}
                                    </Badge>
                                    
                                    {image.featured && (
                                      <Badge className="bg-yellow-100 text-yellow-700">
                                        Featured
                                      </Badge>
                                    )}
                                    
                                    {image.tags.map((tag) => (
                                      <Badge key={tag} className="bg-blue-50 text-blue-600">
                                        {tag}
                                      </Badge>
                                    ))}
                                  </div>
                                  
                                  <div className="text-sm text-blue-700 mt-2">
                                    Photographer: {image.photographer}
                                  </div>
                                </>
                              )}
                            </div>
                            
                            {/* Actions */}
                            <div className="flex md:flex-col gap-2 justify-end">
                                {editingId === (image._id || image.id) ? (
                                <>
                                  <Button 
                                    size="sm" 
                                    onClick={handleSaveEdits}
                                    className="bg-green-600 hover:bg-green-700"
                                      disabled={isLoading}
                                  >
                                    <Save className="h-4 w-4 mr-1" />
                                    Save
                                  </Button>
                                  <Button 
                                    size="sm" 
                                    variant="outline"
                                    onClick={handleCancelEdits}
                                      disabled={isLoading}
                                  >
                                    <X className="h-4 w-4 mr-1" />
                                    Cancel
                                  </Button>
                                </>
                              ) : (
                                <>
                                  <Button 
                                    size="sm" 
                                    variant="outline"
                                      onClick={() => handleEditClick(image._id || image.id || "")}
                                      disabled={isLoading}
                                  >
                                    <Edit className="h-4 w-4 mr-1" />
                                    Edit
                                  </Button>
                                  <Button 
                                    size="sm" 
                                    variant="outline"
                                    className="text-red-600 border-red-200 hover:bg-red-50 hover:text-red-700"
                                      onClick={() => handleDeleteImage(image._id || image.id || "")}
                                      disabled={isLoading}
                                  >
                                    <Trash2 className="h-4 w-4 mr-1" />
                                    Delete
                                  </Button>
                                </>
                              )}
                            </div>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                  )}
                </CardContent>
              </Card>
            </TabsContent>
            
            <TabsContent value="hr" className="space-y-6">
              <div className="mb-6">
                <h1 className="text-2xl font-bold text-blue-900">HR Management</h1>
                <p className="text-blue-700">Add and manage recruiters</p>
              </div>
              
              {/* Add new recruiter form */}
              <Card className="bg-white border-blue-100 shadow-lg">
                <CardHeader>
                  <CardTitle>Add New Recruiter</CardTitle>
                  <CardDescription>Create a new recruiter account for job posting</CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="email">Email <span className="text-red-500">*</span></Label>
                      <Input 
                        id="email" 
                        value={newRecruiter.email}
                        onChange={(e) => setNewRecruiter({...newRecruiter, email: e.target.value})}
                        placeholder="example@company.com"
                        type="email"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="phone">Phone</Label>
                      <Input 
                        id="phone" 
                        value={newRecruiter.phone}
                        onChange={(e) => setNewRecruiter({...newRecruiter, phone: e.target.value})}
                        placeholder="+1234567890"
                      />
                    </div>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="password">Password <span className="text-red-500">*</span></Label>
                    <div className="text-xs text-blue-600 mb-1">
                      Set a temporary password for the recruiter to use for their first login
                    </div>
                    <Input 
                      id="password" 
                      value={newRecruiter.password}
                      onChange={(e) => setNewRecruiter({...newRecruiter, password: e.target.value})}
                      placeholder="Temporary password"
                      type="text"
                    />
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="firstName">First Name <span className="text-red-500">*</span></Label>
                      <Input 
                        id="firstName" 
                        value={newRecruiter.firstName}
                        onChange={(e) => setNewRecruiter({...newRecruiter, firstName: e.target.value})}
                        placeholder="John"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="lastName">Last Name <span className="text-red-500">*</span></Label>
                      <Input 
                        id="lastName" 
                        value={newRecruiter.lastName}
                        onChange={(e) => setNewRecruiter({...newRecruiter, lastName: e.target.value})}
                        placeholder="Smith"
                      />
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="company">Company Name <span className="text-red-500">*</span></Label>
                      <Input 
                        id="company" 
                        value={newRecruiter.company}
                        onChange={(e) => setNewRecruiter({...newRecruiter, company: e.target.value})}
                        placeholder="Company Inc."
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="position">Position <span className="text-red-500">*</span></Label>
                      <Input 
                        id="position" 
                        value={newRecruiter.position}
                        onChange={(e) => setNewRecruiter({...newRecruiter, position: e.target.value})}
                        placeholder="HR Manager"
                      />
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="location">Location</Label>
                      <Input 
                        id="location" 
                        value={newRecruiter.location || ''}
                        onChange={(e) => setNewRecruiter({...newRecruiter, location: e.target.value})}
                        placeholder="City, State"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label htmlFor="website">Company Website</Label>
                      <Input 
                        id="website" 
                        value={newRecruiter.companyWebsite || ''}
                        onChange={(e) => setNewRecruiter({...newRecruiter, companyWebsite: e.target.value})}
                        placeholder="https://company.com"
                        type="url"
                      />
                    </div>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="verified">Verification Status</Label>
                    <Select 
                      value={newRecruiter.verified ? "verified" : "unverified"}
                      onValueChange={(value) => setNewRecruiter({...newRecruiter, verified: value === "verified"})}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Select verification status" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="verified">Verified</SelectItem>
                        <SelectItem value="unverified">Unverified</SelectItem>
                      </SelectContent>
                    </Select>
                    <p className="text-xs text-blue-600">
                      Verified recruiters can post jobs immediately. Unverified recruiters need approval.
                    </p>
                  </div>
                </CardContent>
                <CardFooter className="flex gap-3">
                  <Button 
                    variant="outline" 
                    onClick={() => {
                      setNewRecruiter({
                        email: "",
                        firstName: "",
                        lastName: "",
                        company: "",
                        position: "",
                        phone: "",
                        password: "",
                        verified: false
                      });
                    }}
                  >
                    <X className="h-4 w-4 mr-2" />
                    Clear
                  </Button>
                  <Button 
                    onClick={handleAddRecruiter}
                    disabled={isLoading}
                  >
                    {isLoading ? (
                      <>
                        <div className="animate-spin h-4 w-4 mr-2 border-2 border-t-transparent border-white rounded-full" />
                        Adding...
                      </>
                    ) : (
                      <>
                        <Plus className="h-4 w-4 mr-2" />
                        Add Recruiter
                      </>
                    )}
                  </Button>
                </CardFooter>
              </Card>
              
              {/* Recruiters List */}
              <Card className="bg-white border-blue-100 shadow-lg">
                <CardHeader>
                  <div className="flex items-center justify-between">
                    <div>
                      <CardTitle>Recruiters</CardTitle>
                      <CardDescription>Manage existing recruiters</CardDescription>
                    </div>
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={fetchRecruiters}
                      disabled={isLoadingRecruiters}
                    >
                      <RefreshCcw className={`mr-2 h-4 w-4 ${isLoadingRecruiters ? 'animate-spin' : ''}`} />
                      Refresh
                    </Button>
                  </div>
                </CardHeader>
                <CardContent>
                  {isLoadingRecruiters ? (
                    <div className="flex justify-center py-8">
                      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    </div>
                  ) : (
                    <div className="space-y-4">
                      {recruiters.length === 0 ? (
                        <div className="text-center py-8 text-blue-700">
                          No recruiters added yet. Add your first recruiter above.
                        </div>
                      ) : (
                        <div className="overflow-x-auto">
                          <table className="w-full border-collapse">
                            <thead>
                              <tr className="border-b border-blue-100">
                                <th className="px-4 py-3 text-left text-sm font-semibold text-blue-900">Name</th>
                                <th className="px-4 py-3 text-left text-sm font-semibold text-blue-900">Email</th>
                                <th className="px-4 py-3 text-left text-sm font-semibold text-blue-900">Company</th>
                                <th className="px-4 py-3 text-left text-sm font-semibold text-blue-900">Status</th>
                                <th className="px-4 py-3 text-left text-sm font-semibold text-blue-900">Jobs</th>
                                <th className="px-4 py-3 text-right text-sm font-semibold text-blue-900">Actions</th>
                              </tr>
                            </thead>
                            <tbody>
                              {recruiters.map((recruiter) => (
                                <tr 
                                  key={recruiter._id || recruiter.id} 
                                  className="border-b border-blue-50 hover:bg-blue-50"
                                >
                                  {editingRecruiterId === recruiter._id || editingRecruiterId === recruiter.id ? (
                                    // Editing mode
                                    <>
                                      <td className="px-4 py-3">
                                        <div className="flex flex-col space-y-1">
                                          <Input 
                                            value={recruiter.firstName}
                                            onChange={(e) => handleUpdateEditedRecruiter(
                                              recruiter._id || recruiter.id || '', 
                                              'firstName', 
                                              e.target.value
                                            )}
                                            placeholder="First Name"
                                            className="h-8 text-sm"
                                          />
                                          <Input 
                                            value={recruiter.lastName}
                                            onChange={(e) => handleUpdateEditedRecruiter(
                                              recruiter._id || recruiter.id || '', 
                                              'lastName', 
                                              e.target.value
                                            )}
                                            placeholder="Last Name"
                                            className="h-8 text-sm"
                                          />
                                        </div>
                                      </td>
                                      <td className="px-4 py-3">
                                        <Input 
                                          value={recruiter.email}
                                          onChange={(e) => handleUpdateEditedRecruiter(
                                            recruiter._id || recruiter.id || '', 
                                            'email', 
                                            e.target.value
                                          )}
                                          placeholder="Email"
                                          className="h-8 text-sm"
                                          type="email"
                                        />
                                      </td>
                                      <td className="px-4 py-3">
                                        <div className="flex flex-col space-y-1">
                                          <Input 
                                            value={recruiter.company}
                                            onChange={(e) => handleUpdateEditedRecruiter(
                                              recruiter._id || recruiter.id || '', 
                                              'company', 
                                              e.target.value
                                            )}
                                            placeholder="Company"
                                            className="h-8 text-sm"
                                          />
                                          <Input 
                                            value={recruiter.position}
                                            onChange={(e) => handleUpdateEditedRecruiter(
                                              recruiter._id || recruiter.id || '', 
                                              'position', 
                                              e.target.value
                                            )}
                                            placeholder="Position"
                                            className="h-8 text-sm"
                                          />
                                        </div>
                                      </td>
                                      <td className="px-4 py-3">
                                        <Select 
                                          value={recruiter.verified ? "verified" : "unverified"}
                                          onValueChange={(value) => handleUpdateEditedRecruiter(
                                            recruiter._id || recruiter.id || '', 
                                            'verified', 
                                            value === "verified"
                                          )}
                                        >
                                          <SelectTrigger className="h-8 text-sm">
                                            <SelectValue placeholder="Status" />
                                          </SelectTrigger>
                                          <SelectContent>
                                            <SelectItem value="verified">Verified</SelectItem>
                                            <SelectItem value="unverified">Unverified</SelectItem>
                                          </SelectContent>
                                        </Select>
                                      </td>
                                      <td className="px-4 py-3 text-sm text-blue-900">
                                        {recruiter.jobsPosted?.length || 0}
                                      </td>
                                      <td className="px-4 py-3 text-right space-x-1">
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => handleToggleVerification(recruiter._id || recruiter.id || '')}
                                          disabled={isLoading}
                                          title={recruiter.verified ? "Remove verification" : "Verify recruiter"}
                                        >
                                          <Shield className={`h-4 w-4 ${recruiter.verified ? 'text-green-500' : 'text-amber-500'}`} />
                                          <span className="sr-only">
                                            {recruiter.verified ? "Unverify" : "Verify"}
                                          </span>
                                        </Button>
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => setShowPasswordDialog(recruiter._id || recruiter.id || '')}
                                          title="Change password"
                                        >
                                          <Key className="h-4 w-4 text-blue-500" />
                                          <span className="sr-only">Change Password</span>
                                        </Button>
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => handleEditRecruiterClick(recruiter._id || recruiter.id || '')}
                                          title="Edit recruiter"
                                        >
                                          <Edit className="h-4 w-4" />
                                          <span className="sr-only">Edit</span>
                                        </Button>
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => handleDeleteRecruiter(recruiter._id || recruiter.id || '')}
                                          disabled={isLoading}
                                          title="Delete recruiter"
                                          className="text-red-500 hover:text-red-700 hover:bg-red-50"
                                        >
                                          <Trash2 className="h-4 w-4" />
                                          <span className="sr-only">Delete</span>
                                        </Button>
                                      </td>
                                    </>
                                  ) : (
                                    // Display mode
                                    <>
                                      <td className="px-4 py-3">
                                        <div className="font-medium text-blue-900">
                                          {recruiter.firstName} {recruiter.lastName}
                                        </div>
                                        <div className="text-xs text-blue-700">
                                          {recruiter.company} - {recruiter.position}
                                        </div>
                                      </td>
                                      <td className="px-4 py-3">
                                        <div className="flex items-center">
                                          <Mail className="h-4 w-4 mr-2 text-blue-500" />
                                          <span className="text-blue-900">{recruiter.email}</span>
                                        </div>
                                        {recruiter.phone && (
                                          <div className="text-xs text-blue-700 mt-1">
                                            {recruiter.phone}
                                          </div>
                                        )}
                                      </td>
                                      <td className="px-4 py-3">
                                        <div className="font-medium text-blue-900">
                                          {recruiter.company}
                                        </div>
                                        <div className="text-xs text-blue-700">
                                          {recruiter.position}
                                        </div>
                                      </td>
                                      <td className="px-4 py-3">
                                        {recruiter.verified ? (
                                          <Badge className="bg-green-100 text-green-800 hover:bg-green-200">
                                            <Check className="h-3 w-3 mr-1" />
                                            Verified
                                          </Badge>
                                        ) : (
                                          <Badge className="bg-amber-100 text-amber-800 hover:bg-amber-200">
                                            <Shield className="h-3 w-3 mr-1" />
                                            Unverified
                                          </Badge>
                                        )}
                                      </td>
                                      <td className="px-4 py-3 text-sm text-blue-900">
                                        {recruiter.jobsPosted?.length || 0}
                                      </td>
                                      <td className="px-4 py-3 text-right space-x-1">
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => handleToggleVerification(recruiter._id || recruiter.id || '')}
                                          disabled={isLoading}
                                          title={recruiter.verified ? "Remove verification" : "Verify recruiter"}
                                        >
                                          <Shield className={`h-4 w-4 ${recruiter.verified ? 'text-green-500' : 'text-amber-500'}`} />
                                          <span className="sr-only">
                                            {recruiter.verified ? "Unverify" : "Verify"}
                                          </span>
                                        </Button>
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => setShowPasswordDialog(recruiter._id || recruiter.id || '')}
                                          title="Change password"
                                        >
                                          <Key className="h-4 w-4 text-blue-500" />
                                          <span className="sr-only">Change Password</span>
                                        </Button>
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => handleEditRecruiterClick(recruiter._id || recruiter.id || '')}
                                          title="Edit recruiter"
                                        >
                                          <Edit className="h-4 w-4" />
                                          <span className="sr-only">Edit</span>
                                        </Button>
                                        <Button 
                                          variant="ghost" 
                                          size="sm" 
                                          onClick={() => handleDeleteRecruiter(recruiter._id || recruiter.id || '')}
                                          disabled={isLoading}
                                          title="Delete recruiter"
                                          className="text-red-500 hover:text-red-700 hover:bg-red-50"
                                        >
                                          <Trash2 className="h-4 w-4" />
                                          <span className="sr-only">Delete</span>
                                        </Button>
                                      </td>
                                    </>
                                  )}
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                      )}
                    </div>
                  )}
                </CardContent>
              </Card>
            </TabsContent>
            
            <TabsContent value="users">
              <div className="mb-6">
                <h1 className="text-2xl font-bold text-blue-900">User Management</h1>
                <p className="text-blue-700">This feature is not implemented in the client-side only version</p>
              </div>
            </TabsContent>
            
            <TabsContent value="courses">
              {selectedCourse ? (
                // Lesson Management View
                <div>
                  <div className="mb-6 flex items-center">
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={handleBackToCourses} 
                      className="mr-3"
                    >
                      <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                      </svg>
                      Back to Courses
                    </Button>
                    <h1 className="text-2xl font-bold text-blue-900">
                      {selectedCourse.title} - Lessons
                    </h1>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {/* Add/Edit Lesson Form */}
                    {isAddingLesson ? (
                      <Card className="md:col-span-1 bg-white border-blue-100 shadow-lg">
                        <CardHeader>
                          <CardTitle className="flex items-center text-blue-900">
                            <Book className="mr-2 h-5 w-5" />
                            {editingLessonId ? "Edit Lesson" : "Add New Lesson"}
                          </CardTitle>
                          <CardDescription>
                            {editingLessonId ? "Update lesson details" : "Fill in lesson details"}
                          </CardDescription>
                        </CardHeader>
                        <CardContent>
                          <form className="space-y-4">
                            <div className="space-y-2">
                              <Label htmlFor="lessonTitle">Lesson Title*</Label>
                              <Input
                                id="lessonTitle"
                                placeholder="Introduction to the Course"
                                value={newLesson.title}
                                onChange={(e) => setNewLesson({...newLesson, title: e.target.value})}
                              />
                            </div>
                            
                            <div className="space-y-2">
                              <Label htmlFor="lessonDescription">Description</Label>
                              <Textarea
                                id="lessonDescription"
                                placeholder="Provide a brief description of this lesson"
                                value={newLesson.description}
                                onChange={(e) => setNewLesson({...newLesson, description: e.target.value})}
                                rows={3}
                              />
                            </div>
                            
                            <div className="space-y-2">
                              <Label htmlFor="videoId">Video ID*</Label>
                              <Input
                                id="videoId"
                                placeholder="Enter the video ID"
                                value={newLesson.videoId}
                                onChange={(e) => setNewLesson({...newLesson, videoId: e.target.value})}
                              />
                              <p className="text-xs text-blue-600">
                                Enter only the video ID, not the full URL.
                              </p>
                            </div>
                            
                            <div className="space-y-2">
                              <Label htmlFor="videoSource">Video Source</Label>
                              <Select
                                value={newLesson.videoSource || 'drive'}
                                onValueChange={(value) => setNewLesson({...newLesson, videoSource: value})}
                              >
                                <SelectTrigger id="videoSource">
                                  <SelectValue placeholder="Select video source" />
                                </SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="drive">Google Drive</SelectItem>
                                  <SelectItem value="youtube">YouTube</SelectItem>
                                  <SelectItem value="vimeo">Vimeo</SelectItem>
                                </SelectContent>
                              </Select>
                              <p className="text-xs text-blue-600">
                                {newLesson.videoSource === 'drive' && "For Google Drive, upload the video to Drive and paste the file ID."}
                                {newLesson.videoSource === 'youtube' && "For YouTube, paste the video ID (the part after v= in the URL)."}
                                {newLesson.videoSource === 'vimeo' && "For Vimeo, paste the video ID (the numbers at the end of the URL)."}
                              </p>
                            </div>
                            
                            <div className="space-y-2">
                              <Label htmlFor="duration">Duration (minutes)</Label>
                              <Input
                                id="duration"
                                type="number"
                                min={0}
                                placeholder="30"
                                value={newLesson.duration}
                                onChange={(e) => setNewLesson({...newLesson, duration: Number(e.target.value)})}
                              />
                            </div>
                            
                            <div className="pt-4 flex justify-end space-x-2">
                              <Button 
                                variant="outline" 
                                onClick={() => {
                                  setIsAddingLesson(false)
                                  setEditingLessonId(null)
                                  setNewLesson({
                                    title: '',
                                    description: '',
                                    course: selectedCourse._id || selectedCourse.id as string,
                                    videoId: '',
                                    videoSource: 'drive',
                                    duration: 0,
                                    order: 0
                                  })
                                }}
                              >
                                Cancel
                              </Button>
                              <Button 
                                disabled={isLoading}
                                onClick={editingLessonId ? handleUpdateLesson : handleAddLesson}
                              >
                                {isLoading ? (
                                  <>
                                    <div className="h-4 w-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                    {editingLessonId ? "Updating..." : "Adding..."}
                                  </>
                                ) : (
                                  editingLessonId ? "Update Lesson" : "Add Lesson"
                                )}
                              </Button>
                            </div>
                          </form>
                        </CardContent>
                      </Card>
                    ) : (
                      <Card className="md:col-span-1 bg-white border-blue-100 shadow-lg">
                        <CardHeader>
                          <CardTitle className="flex items-center text-blue-900">
                            <Book className="mr-2 h-5 w-5" />
                            {editingLessonId ? "Edit Lesson" : "Add New Lesson"}
                        </CardTitle>
                        <CardDescription>
                            {editingLessonId ? "Update lesson details" : "Fill in lesson details"}
                        </CardDescription>
                      </CardHeader>
                      <CardContent>
                          <form className="space-y-4">
                          <div className="space-y-2">
                              <Label htmlFor="lessonTitle">Lesson Title*</Label>
                            <Input
                                id="lessonTitle"
                                placeholder="Introduction to the Course"
                                value={newLesson.title}
                                onChange={(e) => setNewLesson({...newLesson, title: e.target.value})}
                            />
                          </div>
                          
                          <div className="space-y-2">
                              <Label htmlFor="lessonDescription">Description</Label>
                            <Textarea
                                id="lessonDescription"
                                placeholder="Provide a brief description of this lesson"
                                value={newLesson.description}
                                onChange={(e) => setNewLesson({...newLesson, description: e.target.value})}
                                rows={3}
                            />
                          </div>
                          
                            <div className="space-y-2">
                              <Label htmlFor="videoId">Video ID*</Label>
                              <Input
                                id="videoId"
                                placeholder="Enter the video ID"
                                value={newLesson.videoId}
                                onChange={(e) => setNewLesson({...newLesson, videoId: e.target.value})}
                              />
                              <p className="text-xs text-blue-600">
                                Enter only the video ID, not the full URL.
                              </p>
                            </div>
                            
                            <div className="space-y-2">
                              <Label htmlFor="videoSource">Video Source</Label>
                              <Select
                                value={newLesson.videoSource || 'drive'}
                                onValueChange={(value) => setNewLesson({...newLesson, videoSource: value})}
                              >
                                <SelectTrigger id="videoSource">
                                  <SelectValue placeholder="Select video source" />
                                </SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="drive">Google Drive</SelectItem>
                                  <SelectItem value="youtube">YouTube</SelectItem>
                                  <SelectItem value="vimeo">Vimeo</SelectItem>
                                </SelectContent>
                              </Select>
                              <p className="text-xs text-blue-600">
                                {newLesson.videoSource === 'drive' && "For Google Drive, upload the video to Drive and paste the file ID."}
                                {newLesson.videoSource === 'youtube' && "For YouTube, paste the video ID (the part after v= in the URL)."}
                                {newLesson.videoSource === 'vimeo' && "For Vimeo, paste the video ID (the numbers at the end of the URL)."}
                              </p>
                          </div>
                          
                            <div className="space-y-2">
                              <Label htmlFor="duration">Duration (minutes)</Label>
                              <Input
                                id="duration"
                                type="number"
                                min={0}
                                placeholder="30"
                                value={newLesson.duration}
                                onChange={(e) => setNewLesson({...newLesson, duration: Number(e.target.value)})}
                              />
                          </div>
                          
                            <div className="pt-4 flex justify-end space-x-2">
                            <Button 
                              variant="outline" 
                              onClick={() => {
                                  setIsAddingLesson(false)
                                  setEditingLessonId(null)
                                  setNewLesson({
                                    title: '',
                                    description: '',
                                    course: selectedCourse._id || selectedCourse.id as string,
                                    videoId: '',
                                    videoSource: 'drive',
                                    duration: 0,
                                    order: 0
                                  })
                              }}
                            >
                                Cancel
                            </Button>
                              <Button 
                                disabled={isLoading}
                                onClick={editingLessonId ? handleUpdateLesson : handleAddLesson}
                              >
                                {isLoading ? (
                                  <>
                                    <div className="h-4 w-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                    {editingLessonId ? "Updating..." : "Adding..."}
                                  </>
                                ) : (
                                  editingLessonId ? "Update Lesson" : "Add Lesson"
                                )}
                            </Button>
                            </div>
                          </form>
                        </CardContent>
                    </Card>
                    )}
                    
                    {/* Course List */}
                    <div className="md:col-span-2">
                      <Card className="bg-white border-blue-100 shadow-lg">
                        <CardHeader>
                          <CardTitle className="flex items-center justify-between">
                            <span className="flex items-center">
                              <Book className="mr-2 h-5 w-5" />
                              Courses
                            </span>
                            <Button
                              variant="outline"
                              size="sm"
                              onClick={fetchCourses}
                              disabled={isLoadingCourses}
                              className="flex items-center"
                            >
                              <RefreshCcw className={`mr-2 h-4 w-4 ${isLoadingCourses ? 'animate-spin' : ''}`} />
                              Refresh
                            </Button>
                          </CardTitle>
                          <CardDescription>Manage existing courses</CardDescription>
                        </CardHeader>
                        <CardContent>
                          {isLoadingCourses ? (
                            <div className="text-center py-8">
                              <div className="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]"></div>
                              <p className="mt-2 text-blue-700">Loading courses...</p>
                            </div>
                          ) : courses.length === 0 ? (
                            <div className="text-center py-8 border rounded-lg border-dashed border-blue-200">
                              <Book className="h-12 w-12 text-blue-300 mx-auto mb-3" />
                              <h3 className="text-lg font-semibold text-blue-900 mb-1">No courses yet</h3>
                              <p className="text-blue-700 mb-4">Create your first course to get started</p>
                            </div>
                          ) : (
                            <div className="space-y-4">
                              {courses.map((course) => (
                                <div
                                  key={course._id || course.id}
                                  className="border rounded-lg p-4 flex flex-col md:flex-row gap-4 bg-white hover:shadow-md transition-shadow"
                                >
                                  {/* Course thumbnail */}
                                  <div className="w-full md:w-40 h-40 bg-blue-100 rounded-lg overflow-hidden flex-shrink-0">
                                    {course.thumbnail ? (
                                      <img
                                        src={course.thumbnail.includes('://') ? course.thumbnail : convertGoogleDriveUrl(course.thumbnail)}
                                        alt={course.title}
                                        className="w-full h-full object-cover"
                                        onError={(e) => {
                                          (e.target as HTMLImageElement).src = "/placeholder.svg?height=600&width=800";
                                        }}
                                      />
                                    ) : (
                                      <div className="w-full h-full flex items-center justify-center bg-blue-50">
                                        <Book className="h-10 w-10 text-blue-300" />
                                      </div>
                                    )}
                                  </div>
                                  
                                  {/* Course details */}
                                  <div className="flex-1">
                                    <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-2">
                                      <div>
                                        <h3 className="text-lg font-semibold text-blue-900">{course.title}</h3>
                                        <p className="text-sm text-blue-700 mb-2">By {course.instructor}</p>
                                      </div>
                                      <div className="flex items-center space-x-2">
                                        <Badge variant={course.isPublished ? "default" : "outline"}>
                                          {course.isPublished ? "Published" : "Draft"}
                                        </Badge>
                                        <Badge variant="secondary">{course.level}</Badge>
                                      </div>
                                    </div>
                                    
                                    <p className="text-blue-600 text-sm mb-2 line-clamp-2">{course.description}</p>
                                    
                                    <div className="flex flex-wrap gap-1 mb-3">
                                      {course.tags.map((tag, index) => (
                                        <Badge key={index} variant="outline" className="bg-blue-50">
                                          {tag}
                                        </Badge>
                                      ))}
                                    </div>
                                    
                                    <div className="flex flex-wrap justify-between items-center gap-2">
                                      <div className="text-sm text-blue-700 space-x-4">
                                        <span>{course.lessonCount || 0} lessons</span>
                                        <span>{course.duration || 0} min</span>
                                        <span className="font-semibold">${course.price.toFixed(2)}</span>
                                        {course.discountPrice !== undefined && course.discountPrice > 0 && (
                                          <span className="text-red-500">${course.discountPrice.toFixed(2)}</span>
                                        )}
                                      </div>
                                      
                                      <div className="flex items-center space-x-2">
                                        <Button
                                          variant="outline"
                                          size="sm"
                                          onClick={() => handleTogglePublished(course._id || course.id || "")}
                                        >
                                          {course.isPublished ? "Unpublish" : "Publish"}
                                        </Button>
                                        <Button
                                          variant="outline"
                                          size="sm"
                                          onClick={() => handleManageLessons(course._id || course.id || "")}
                                        >
                                          Lessons
                                        </Button>
                                        <Button
                                          variant="outline"
                                          size="sm"
                                          onClick={() => handleEditCourseClick(course._id || course.id || "")}
                                        >
                                          <Edit className="h-4 w-4" />
                                        </Button>
                                        <Button
                                          variant="outline"
                                          size="sm"
                                          className="text-red-500 hover:text-red-700 hover:bg-red-50"
                                          onClick={() => handleDeleteCourse(course._id || course.id || "")}
                                        >
                                          <Trash2 className="h-4 w-4" />
                                        </Button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              ))}
                            </div>
                          )}
                        </CardContent>
                      </Card>
                    </div>
                  </div>
                </>
              )}
            </TabsContent>
          </Tabs>
        </div>
      </div>

      {/* Password Change Dialog */}
      <Dialog open={!!showPasswordDialog} onOpenChange={(open) => {
        if (!open) {
          setShowPasswordDialog(null);
          setNewPasswordMap({});
        }
      }}>
        <DialogContent className="sm:max-w-md">
          <DialogHeader>
            <DialogTitle>Change Password</DialogTitle>
            <DialogDescription>
              Set a new password for this recruiter account
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label htmlFor="new-password">New Password</Label>
              <div className="flex items-center">
                <LockIcon className="w-4 h-4 mr-2 text-blue-500" />
                <Input
                  id="new-password"
                  type="text"
                  placeholder="Enter new password" 
                  value={showPasswordDialog ? newPasswordMap[showPasswordDialog] || '' : ''}
                  onChange={(e) => {
                    if (showPasswordDialog) {
                      setNewPasswordMap(prev => ({
                        ...prev,
                        [showPasswordDialog]: e.target.value
                      }));
                    }
                  }}
                />
              </div>
              <p className="text-sm text-muted-foreground">
                Password must be at least 6 characters long
              </p>
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowPasswordDialog(null)}>
              Cancel
            </Button>
            <Button 
              onClick={() => {
                if (showPasswordDialog) {
                  handleUpdateRecruiterPassword(showPasswordDialog);
                  setShowPasswordDialog(null);
                }
              }}
              disabled={
                !showPasswordDialog || 
                !newPasswordMap[showPasswordDialog] || 
                newPasswordMap[showPasswordDialog].length < 6 ||
                isLoading
              }
            >
              {isLoading ? 'Updating...' : 'Update Password'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  )
} 